{{ 'fragrance-finder.css' | asset_url | stylesheet_tag }}


<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8"/>
    <meta
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
            name="viewport"
    />

    <!-- Bootstrap CSS -->
    <link
            crossorigin="anonymous"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
            integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
            rel="stylesheet"
    />


    <link href="https://fonts.gstatic.com" rel="preconnect"/>
    <link
            href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
            rel="stylesheet"
    />

    <link
            crossorigin="anonymous"
            href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.css"
            integrity="sha512-wR4oNhLBHf7smjy0K4oqzdWumd+r5/+6QO/vDda76MW5iug4PT7v86FoEkySIJft3XA0Ae6axhIvHrqwm793Nw=="
            rel="stylesheet"
    />

    <script
            crossorigin="anonymous"
            src="https://kit.fontawesome.com/a459ffe687.js"
    ></script>
    <title>Result page</title>
</head>

<body>
<section class="result-header text-center">
    <div class="container">
        <i class="fas fa-heart"></i>
        <h2 id="nameOfCustomer"></h2>
        <h3 id='step1Ans'>HERE ARE YOUR FRAGRANCE MATCHES</h3>
        <!-- Carousel css at the end of this page -->
        <div class="carousel slide mt-5" data-ride="carousel" id="myCarousel">
            <div class="carousel-inner row w-100 mx-auto">
                <div class="carousel-item col-md-3 active">
                    <div class="product-box">
                        <div class="image-loader"></div>
                        <p class="title-loader mt-3 mb-2"></p>
                        <p class="title-loader mt-1 w-75"></p>

                        <div class="row">
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-6">
                                <b class="price-loader d-inline-block"></b><br/>
                            </div>
                        </div>
                        <hr/>
                        <h6>SCENT</h6>
                        <div class="tag-loader"></div>
                        <hr/>
                        <div class="product-button button-loader mt-1"></div>
                    </div>
                </div>
                <div class="carousel-item col-md-3">
                    <div class="product-box">
                        <div class="image-loader"></div>
                        <p class="title-loader mt-3 mb-2"></p>
                        <p class="title-loader mt-1 w-75"></p>

                        <div class="row">
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-6">
                                <b class="price-loader d-inline-block"></b><br/>
                            </div>
                        </div>
                        <hr/>
                        <h6>SCENT</h6>
                        <div class="tag-loader"></div>
                        <hr/>
                        <div class="product-button button-loader mt-1"></div>
                    </div>
                </div>
                <div class="carousel-item col-md-3">
                    <div class="product-box">
                        <div class="image-loader"></div>
                        <p class="title-loader mt-3 mb-2"></p>
                        <p class="title-loader mt-1 w-75"></p>

                        <div class="row">
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-6">
                                <b class="price-loader d-inline-block"></b><br/>
                            </div>
                        </div>
                        <hr/>
                        <h6>SCENT</h6>
                        <div class="tag-loader"></div>
                        <hr/>
                        <div class="product-button button-loader mt-1"></div>
                    </div>
                </div>
                <div class="carousel-item col-md-3">
                    <div class="product-box">
                        <div class="image-loader"></div>
                        <p class="title-loader mt-3 mb-2"></p>
                        <p class="title-loader mt-1 w-75"></p>

                        <div class="row">
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-6">
                                <b class="price-loader d-inline-block"></b><br/>
                            </div>
                        </div>
                        <hr/>
                        <h6>SCENT</h6>
                        <div class="tag-loader"></div>
                        <hr/>
                        <div class="product-button button-loader mt-1"></div>
                    </div>
                </div>
            </div>

            <div class="progress">
                <div
                        aria-valuemax="100"
                        aria-valuemin="0"
                        aria-valuenow=""
                        class="progress-bar"
                        role="progressbar"
                ></div>
            </div>

            <a
                    class="carousel-control-prev"
                    data-slide="prev"
                    href="#myCarousel"
                    role="button"
            >
                <span aria-hidden="true" class="carousel-control-prev-icon"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a
                    class="carousel-control-next"
                    data-slide="next"
                    href="#myCarousel"
                    role="button"
            >
                <span aria-hidden="true" class="carousel-control-next-icon"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>

      	<div class='d-flex justify-content-center'>
        <a
                class="result-button mt-5"
                href="./fragrance-finder"
                id="buttonColor"
        >RESTART</a
        >
      </div>
    </div>
</section>

<section id="test"></section>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-latest.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>

    <script
            crossorigin="anonymous"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    ></script>
    <script
            crossorigin="anonymous"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    ></script>
    <!-- Shopify sdk -->
    <script src="https://sdks.shopifycdn.com/js-buy-sdk/v2/latest/index.umd.min.js"></script>
    <script
            crossorigin="anonymous"
            integrity="sha512-XtmMtDEcNz2j7ekrtHvOVR4iwwaD6o/FUJe6+Zq+HgcCsk3kj4uSQQR8weQ2QVj1o0Pk6PwYLohm206ZzNfubg=="
            src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"
    ></script>

<script>
        function shuffle(array) {
          let currentIndex = array.length,  randomIndex;

          // While there remain elements to shuffle...
          while (currentIndex != 0) {

            // Pick a remaining element...
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;

            // And swap it with the current element.
            [array[currentIndex], array[randomIndex]] = [
              array[randomIndex], array[currentIndex]];
          }

          return array;
        }
  
        var paramsObject = {};

        const urlParams = new URLSearchParams(window.location.search);
        urlParams.forEach(function (e, w) {
            paramsObject[w] = e;
        })

        var name = paramsObject.step3;

        var gender = 'unisex';
        switch (paramsObject.step2) {
            case 'genderFluid':
                gender = 'unisex';
                break;
            case 'man':
                gender = 'male';
                break;
            case 'woman':
                gender = 'female';
                break;
        }

      
        var scent = paramsObject.step6;        
        var step1 = paramsObject.step1;

        var nameOfTheFilter = '';

        if (paramsObject.step5 === "similar") {
            nameOfTheFilter = paramsObject.step4;
        }
      
      if (step1 == 'someoneElse') {
        $("#nameOfCustomer").text("");
        $("#step1Ans").text("HERE ARE THE FRAGRANCE MATCHES FOR " + name);
      } else {
        $("#nameOfCustomer").text(name + ",");
      }
  
  
  
  
  
  
    $(document).ready(function () {
        // call shopify api to get products
        const domain = "scentdirect.myshopify.com";
        const storefrontAccessToken = "d3f0dc5c5c981f4d96951b2af78cc0da";
        const apiVersion = "2021-04";

        const client = new window.ShopifyBuy({
            domain,
            storefrontAccessToken,
            apiVersion,
            // language if required
        });

        $("#nameOfCustomer").addClass('text-capitalize');

        //https://shopify.github.io/js-buy-sdk/
        // nameOfTheFilter = 'HUGO BOSS';

        // get the brand in step4 and pass the vendor name to url query params.

        let queryString = "published_status:published AND available_for_sale:true tag:'"+gender+"'";
//       	if (scent) {
//           queryString += " tag:'"+scent+"'";
//         }
        
        if (nameOfTheFilter) {
            queryString += " vendor:'"+nameOfTheFilter+"";
        }
        let query = {
            query: queryString, // title:men OR tag:asdf
            first: 20
        };


        // if there will no result, then call again and get more product without body filter.

        // use tags in query like this, get tags from the url, pass the query in fetchQuery
        // https://stackoverflow.com/questions/48246953/shopify-buy-sdk-multiple-filters
        client.product
            .fetchQuery(query)
            .then(function (products) {
          console.log(products);
                // todo show a loader to the products cards until we ll load products
                // when loaded show products
          		shuffle(products);

                products.map((item) => {
                    if (!item.onlineStoreUrl) {
                        return;
                    }
                    const productFirstVariant = item.variants[0];
                    var card = document.createElement("div");
                    card.classList.add("carousel-item", "col-md-3");

                    var cardInnerDiv = document.createElement("div");
                    cardInnerDiv.classList.add("product-box");
                    var heading = document.createElement("h5");
                    // heading.innerHTML = "BEST MATCH";
                    var paragraph = document.createElement("p");
                    paragraph.style.minHeight = "84px";

                    paragraph.innerHTML = item.title;

                    var image = document.createElement("div");
                    image.classList.add(
                      	"position-relative",
                        "d-flex",
                        "overflow-hidden",
                        "justify-content-center",
                        "align-items-center"
                    );
                    image.style.height = "250px";
                    var abcImage = document.createElement("img");
                    abcImage.setAttribute("src", item.images[0].src);


					var bestMatch = document.createElement("div");
                    bestMatch.classList.add("position-absolute", "text-white", "bg-dark", "px-2", "py-1", "bestMatch");
                  	bestMatch.style.top = '5px';
                    bestMatch.style.left = '5px';                   
                    bestMatch.style.display = 'none';                    
                


                  	bestMatch.innerHTML = 'BEST MATCH';
                  
                  
                    image.appendChild(abcImage);
                    image.appendChild(bestMatch);

                    var priceRow = document.createElement("div");
                    priceRow.classList.add(
                        "col-xl-6",
                        "col-lg-6",
                        "col-md-6",
                        "col-sm-6",
                        "col-6"
                    );
                    var b = document.createElement(b);
                    var br = document.createElement("br");
                    b.innerHTML = (productFirstVariant.priceV2.currencyCode === 'GBP' ? '£' : productFirstVariant.priceV2.currencyCode) + '' + productFirstVariant.priceV2.amount; // price
                    var s = document.createElement("s");

                    s.innerHTML = "";
                    if (productFirstVariant.compareAtPriceV2 && productFirstVariant.compareAtPriceV2.amount) {
                        s.innerHTML = (productFirstVariant.compareAtPriceV2.currencyCode === 'GBP' ? '£' : productFirstVariant.compareAtPriceV2.currencyCode) + '' + parseFloat(productFirstVariant.compareAtPriceV2.amount).toFixed(2); // price
                    }
                    priceRow.appendChild(b);
                    priceRow.appendChild(br);
                    priceRow.appendChild(s);
                    var starRow = `<div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-6"><i class="fas fa-star" aria-hidden="true"></i><i class="fas fa-star" aria-hidden="true"></i><i class="fas fa-star" aria-hidden="true"></i><i class="fas fa-star" aria-hidden="true"></i><i class="fas fa-star" aria-hidden="true"></i><p>(19)</p></div>`;
                    var rowDiv = document.createElement("div");
                    rowDiv.classList.add("row");
                    rowDiv.appendChild(priceRow);
                    var heading6 = document.createElement("h6");
                    heading6.innerHTML = "SCENT";
                    var woodyText = document.createElement("div");
                  	woodyText.classList.add("tag");
                    
                    var span1 = document.createElement("span");
                    
                    span1.innerHTML = scent;
                    span1.classList.add('text-uppercase');
//                     span2.style.marginLeft = "5px";
                    // span2.innerHTML = "AROMATIC";
                    woodyText.appendChild(span1);
//                     woodyText.appendChild(span2);
                    var horizontalRule = document.createElement("hr");
                  	var horizontalRule2 = document.createElement("hr");
                    var anchor = document.createElement("a");
                    anchor.href = item.onlineStoreUrl;
                    anchor.classList.add("product-button");
                    anchor.setAttribute("id", "buttonColor");
                    anchor.innerHTML = "VIEW";
                    anchor.setAttribute("target", "_blank");
                    // cardInnerDiv.appendChild(heading);

                    cardInnerDiv.appendChild(image);
                    cardInnerDiv.appendChild(paragraph);
                    cardInnerDiv.appendChild(rowDiv);
                    cardInnerDiv.appendChild(horizontalRule);
                    if (scent) {
                      cardInnerDiv.appendChild(heading6);
                      cardInnerDiv.appendChild(woodyText);
                    }
                  	cardInnerDiv.appendChild(horizontalRule2);
                    cardInnerDiv.appendChild(anchor);
                    card.appendChild(cardInnerDiv);
                    $(".carousel-inner").append(card);
                  
                  
//                   fetch(`https://www.perfumedirect.com/admin/products/${item.id}/metafields.json?namespace=spr&key=reviews`)
                });
            })
            .finally(function () {
                $(".carousel-inner").find(".carousel-item").slice(0, 4).remove();
                $(".carousel-inner").slick({
                    dots: true,
                    infinite: false,
                    speed: 380,
                    loop: false,
                    slidesToShow: 4,
                    slidesToScroll: 4,
                    dots: true,
                    
                    responsive: [
                        {
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: 3,
                                slidesToScroll: 3,
                                infinite: false,
                            },
                        },
                        {
                            breakpoint: 991,
                            settings: {
                                slidesToShow: 2,
                                slidesToScroll: 2,
                            },
                        },
                        {
                            breakpoint: 600,
                            settings: {
                                slidesToShow: 2,
                                slidesToScroll: 2,
                            },
                        },
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: 1,
                              	arrows: true,
                                slidesToScroll: 1,
                            },
                        },
                        // You can unslick at a given breakpoint now by adding:
                        // settings: "unslick"
                        // instead of a settings object
                    ],
                });
                var currentSlide = $($(".carousel-inner .slick-slide")[0]).data(
                    "slickIndex"
                );
                var totalSlides = $(".carousel-inner .slick-slide").length;
                var percentage = (currentSlide / totalSlides) * 100;
                $(".progress-bar").css("width", percentage + totalSlides + "%");                
                $(".progress-bar").css("background-color", "#75939e");

            });


        $(".carousel-inner").on(
            "afterChange",
            function (event, slick, currentSlide, nextSlide) {
                var totalSlides = $(".carousel-inner .slick-slide").length;

                var percentage = (currentSlide / totalSlides) * 100;
                $(".progress-bar").css("width", percentage + totalSlides + "%");


            }
        );
    });
</script>
<style>
    @media (min-width: 768px) {
        /* show 4 items */
        .carousel-inner .active,
        .carousel-inner .active + .carousel-item,
        .carousel-inner .active + .carousel-item + .carousel-item,
        .carousel-inner
        .active
        + .carousel-item
        + .carousel-item
        + .carousel-item {
            display: block;
        }

        .carousel-inner
        .carousel-item.active:not(.carousel-item-right):not(.carousel-item-left),
        .carousel-inner
        .carousel-item.active:not(.carousel-item-right):not(.carousel-item-left)
        + .carousel-item,
        .carousel-inner
        .carousel-item.active:not(.carousel-item-right):not(.carousel-item-left)
        + .carousel-item
        + .carousel-item,
        .carousel-inner
        .carousel-item.active:not(.carousel-item-right):not(.carousel-item-left)
        + .carousel-item
        + .carousel-item
        + .carousel-item {
            transition: none;
        }

        .carousel-inner .carousel-item-next,
        .carousel-inner .carousel-item-prev {
            position: relative;
            transform: translate3d(0, 0, 0);
        }

        .carousel-inner
        .active.carousel-item
        + .carousel-item
        + .carousel-item
        + .carousel-item
        + .carousel-item {
            position: absolute;
            top: 0;
            right: -25%;
            z-index: -1;
            display: block;
            visibility: visible;
        }

        /* left or forward direction */
        .active.carousel-item-left + .carousel-item-next.carousel-item-left,
        .carousel-item-next.carousel-item-left + .carousel-item,
        .carousel-item-next.carousel-item-left
        + .carousel-item
        + .carousel-item,
        .carousel-item-next.carousel-item-left
        + .carousel-item
        + .carousel-item
        + .carousel-item,
        .carousel-item-next.carousel-item-left
        + .carousel-item
        + .carousel-item
        + .carousel-item
        + .carousel-item {
            position: relative;
            transform: translate3d(-100%, 0, 0);
            visibility: visible;
        }

        /* farthest right hidden item must be absolue position for animations */
        .carousel-inner .carousel-item-prev.carousel-item-right {
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
            display: block;
            visibility: visible;
        }

        /* right or prev direction */
        .active.carousel-item-right + .carousel-item-prev.carousel-item-right,
        .carousel-item-prev.carousel-item-right + .carousel-item,
        .carousel-item-prev.carousel-item-right
        + .carousel-item
        + .carousel-item,
        .carousel-item-prev.carousel-item-right
        + .carousel-item
        + .carousel-item
        + .carousel-item,
        .carousel-item-prev.carousel-item-right
        + .carousel-item
        + .carousel-item
        + .carousel-item
        + .carousel-item {
            position: relative;
            transform: translate3d(100%, 0, 0);
            visibility: visible;
            display: block;
            visibility: visible;
        }
    }

    .carousel-control-prev {
        display: none;
    }

    .carousel-control-next {
        display: none;
    }

    .image-loader {
        width: 100%;
        height: 250px;
        animation: loader 3s infinite ease-in-out;
        -webkit-animation: loader 3s infinite ease-in-out;
    }

    .title-loader {
        height: 12px;
        width: 200px;
        animation: loader 3s infinite ease-in-out;
        -webkit-animation: loader 3s infinite ease-in-out;
    }

    .price-loader {
        height: 12px;
        margin-top: 10px;
        width: 50px;
        animation: loader 3s infinite ease-in-out;
        -webkit-animation: loader 3s infinite ease-in-out;
    }

    .tag-loader {
        height: 12px;
        margin-top: 10px;
        width: 75%;
        animation: loader 3s infinite ease-in-out;
        -webkit-animation: loader 3s infinite ease-in-out;
    }

    .button-loader {
        margin-top: 10px;
        animation: loader 3s infinite ease-in-out;
        -webkit-animation: loader 3s infinite ease-in-out;
    }

    .opacity-0 {
        opacity: 0;
    }

    @keyframes loader {
        0% {
            background-color: rgba(165, 165, 165, 0.1);
        }

        50% {
            background-color: rgba(165, 165, 165, 0.3);
        }

        100% {
            background-color: rgba(165, 165, 165, 0.1);
        }
    }

    @-webkit-keyframes loader {
        0% {
            background-color: rgba(165, 165, 165, 0.1);
        }

        50% {
            background-color: rgba(165, 165, 165, 0.3);
        }

        100% {
            background-color: rgba(165, 165, 165, 0.1);
        }
    }
</style>
</body>
</html>
